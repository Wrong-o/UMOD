<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Bot</title>
    <link rel="stylesheet" href="style.css">


</head>
<body>

    <script>
        // Function to get product name from URL and format it
        function getProductNameFromUrl() {
            const path = window.location.pathname;
            const productName = path.split('/').pop(); // Get last part of URL
            return productName
                .replace(/([A-Z])/g, ' $1')
                .replace(/(\d+)/g, ' $1')
                .split(/(?=[A-Z0-9])/)
                .join(' ')
                .replace(/\s+/g, ' ')
                .trim()
                .replace(/\b\w/g, c => c.toUpperCase());
        }

        // Combine both window.onload functions
        document.addEventListener('DOMContentLoaded', function() {
            // Update header text
            const productName = getProductNameFromUrl();
            console.log("Product Name:", productName); // För debugging
            const headerTitle = document.querySelector('.header-text h1');
            if (headerTitle) {
                headerTitle.textContent = productName;
            } else {
                console.error("Header title element not found");
            }
        });
    </script>


<header>
    <div class="header-content">
        <div class="bot-icon">
            ⚙️
        </div>
        <div class="header-text">
            <h1 id="productTitle">Loading...</h1>
            <div class="status">
                <span class="status-dot"></span>
                Online
            </div>
        </div>
    </div>
</header>

<main>
    <div class="chat-container" id="chatContainer">
        <!-- Messages will be added here dynamically -->
    </div>

    <div class="umod-signature">
        Powered by UMOD
    </div>
</main>


        
    <div class="input-container">
        <div class="input-box">
            <input type="text" id="userInput" class="text-input" placeholder="Type here..." onkeypress="handleKeyPress(event)">
            <button onclick="sendMessage()" class="send-button">Send</button>
        </div>
    </div>


    <script>
        // Move your existing window.onload into a separate function
        window.onload = function() {
            // Update header text again to ensure it's set
            const productName = getProductNameFromUrl();
            document.querySelector('.header-text h1').textContent = productName;
            
            // Your existing welcome message
            typeMessage('Welcome! How can I help you today?');
        }
    </script>

    

<script>
    // Utility function for delay
    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    // Function to animate bot typing message
    async function typeMessage(text) {
        const wrapper = document.createElement('div');
        wrapper.classList.add('message-wrapper');

        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message', 'bot-message');

        const textElement = document.createElement('div');
        textElement.style.whiteSpace = 'pre-line';

        const cursor = document.createElement('span');
        cursor.classList.add('cursor');
        cursor.textContent = '|';

        messageDiv.appendChild(textElement);
        messageDiv.appendChild(cursor);

        const timeDiv = document.createElement('div');
        timeDiv.classList.add('message-time');
        timeDiv.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        messageDiv.appendChild(timeDiv);

        wrapper.appendChild(messageDiv);
        const chatContainer = document.getElementById('chatContainer');
        chatContainer.appendChild(wrapper);
        scrollToBottom();

        const typingSpeed = 10;
        let currentText = '';
        for (let i = 0; i < text.length; i++) {
            currentText += text[i];
            textElement.textContent = currentText;
            await sleep(typingSpeed);
            scrollToBottom();
        }

        cursor.style.display = 'none';
    }

    // Function to create and display user message
    function createUserMessage(text) {
        const wrapper = document.createElement('div');
        wrapper.classList.add('message-wrapper', 'user');

        const message = document.createElement('div');
        message.classList.add('message', 'user-message');
        message.textContent = text;

        const timeDiv = document.createElement('div');
        timeDiv.classList.add('message-time');
        timeDiv.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        message.appendChild(timeDiv);

        wrapper.appendChild(message);
        document.getElementById('chatContainer').appendChild(wrapper);
        scrollToBottom();
    }

    // Function to auto-scroll chat container to the latest message
    function scrollToBottom() {
        const chatContainer = document.getElementById('chatContainer');
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // Function to handle sending messages
    async function sendMessage() {
        const input = document.getElementById('userInput');
        const text = input.value.trim();

        if (text !== '') {
            createUserMessage(text);
            input.value = '';

            // Show "Hm.." indicator while bot is processing
            const thinkingWrapper = document.createElement('div');
            thinkingWrapper.classList.add('message-wrapper');

            const thinkingIndicator = document.createElement('div');
            thinkingIndicator.classList.add('thinking-indicator');
            thinkingIndicator.textContent = 'Hm..';

            thinkingWrapper.appendChild(thinkingIndicator);

            const chatContainer = document.getElementById('chatContainer');
            chatContainer.appendChild(thinkingWrapper);
            scrollToBottom();

            try {
                const response = await fetch('/api', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text })
                });

                const data = await response.json();

                // Remove "Hm.." indicator
                thinkingWrapper.remove();

                // Display actual response
                await typeMessage(data.response);
            } catch (error) {
                console.error('Error:', error);
                thinkingWrapper.remove();
                await typeMessage('Sorry, there was an error processing your message.');
            }
        }
    }

    // Function to handle Enter key for sending messages
    function handleKeyPress(event) {
        if (event.key === 'Enter') {
            sendMessage();
        }
    }

    // Add welcome message on page load
    window.onload = function() {
        typeMessage('Welcome! How can I help you today?');
    }
</script>

</body>
</html>